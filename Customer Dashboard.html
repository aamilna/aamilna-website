<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AaMilNa ‚Ä¢ Customer Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;1,600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#fff7f0;color:#4a3b47;overflow-x:hidden;}

/* üå∏ Floating Bubbles */
.bubble-bg{position:fixed;inset:0;z-index:-1;}
.bubble{position:absolute;width:260px;height:260px;border-radius:50%;background:radial-gradient(circle at top left,rgba(255,255,255,.9),rgba(255,220,230,.45),rgba(200,150,170,.25));animation:float 30s infinite ease-in-out;}
.bubble::after{content:"üå∏";display:flex;align-items:center;justify-content:center;height:100%;font-size:70px;opacity:.35;}
.bubble:nth-child(1){top:8%;left:6%;}
.bubble:nth-child(2){top:55%;left:70%;}
.bubble:nth-child(3){top:30%;left:40%;}
@keyframes float{50%{transform:translateY(-60px);}}

/* Header */
header{display:flex;justify-content:space-between;align-items:center;padding:22px 50px;background:rgba(255,255,255,.85);}
header img{height:90px;cursor:pointer;}
header .actions{display:flex;gap:12px;}
header button{background:#d8a7a0;border:none;padding:10px 22px;border-radius:30px;cursor:pointer;}

/* Dashboard Layout */
.dashboard{max-width:1300px;margin:120px auto 80px;padding:0 30px;}
h1{font-family:'Playfair Display',serif;font-style:italic;font-size:46px;}

/* Profile Box */
.profileBox{display:flex;gap:20px;align-items:flex-start;}
.avatar{width:90px;height:90px;border-radius:50%;object-fit:cover;border:3px solid #d8a7a0;}
.editProfile{margin-top:10px;background:#d8a7a0;border:none;padding:6px 16px;border-radius:20px;font-size:13px;cursor:pointer;}

/* Profile Summary Card */
.profileSummary{background:#fff;padding:20px;border-radius:22px;box-shadow:0 15px 30px rgba(0,0,0,.12);margin-top:10px;display:flex;flex-direction:column;gap:8px;font-size:14px;}
.profileSummary span{font-weight:500;display:inline-block;width:110px;}

/* Grid Layout */
.layout{display:grid;grid-template-columns:2fr 1fr;gap:30px;margin-top:20px;}
.box{background:#fff;padding:25px;border-radius:28px;box-shadow:0 20px 40px rgba(0,0,0,.12);margin-bottom:30px;}

/* Orders */
.orders{max-height:65vh;overflow-y:auto;}
.order{border-bottom:1px solid #eee;padding:12px 0;display:flex;gap:12px;align-items:center;}
.order img{width:60px;height:60px;object-fit:cover;border-radius:12px;}

/* Liked Items */
.likedGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px;}
.likedItem{background:#fff;padding:15px;border-radius:22px;box-shadow:0 12px 30px rgba(0,0,0,.1);position:relative;}
.likedItem img{width:100%;height:150px;object-fit:cover;border-radius:16px;}
.heart{position:absolute;top:12px;right:14px;font-size:22px;cursor:pointer;}

/* Modals */
.modal{position:fixed;inset:0;background:#00000066;display:none;align-items:center;justify-content:center;}
.modalContent{background:white;padding:30px;border-radius:26px;width:400px;position:relative;}
.modalContent input{width:100%;margin-bottom:10px;padding:8px;border-radius:12px;border:1px solid #ddd;}
.closeBtn{position:absolute;top:12px;right:16px;font-size:20px;cursor:pointer;color:#b96a6a;}
.emptyState{opacity:.6;font-size:14px;}
</style>
</head>

<body>

<div class="bubble-bg">
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
</div>

<header>
<img src="logo.png" alt="AaMilNa Logo" onclick="location.href='index.html'">
<div class="actions">
<button onclick="location.href='index.html'">Home</button>
<button onclick="logout()">Logout</button>
</div>
</header>

<section class="dashboard">
<h1>Customer Dashboard</h1>

<!-- Profile Box -->
<div class="box profileBox">
<img id="avatar" class="avatar" alt="Profile Avatar">
<div>
<strong id="cName"></strong><br>
<small id="cEmail"></small><br>
<button class="editProfile" onclick="openProfile()">Edit Profile</button>

<!-- Profile Summary -->
<div class="profileSummary" id="profileSummary"></div>
</div>
</div>

<div class="layout">
  <div>
    <!-- Orders Section -->
    <div class="box">
      <h3>üõç Order History</h3><br>
      <div class="orders" id="orderList"></div>
    </div>

    <!-- Reviews Section -->
    <div class="box">
      <h3>‚≠ê Your Reviews</h3><br>
      <div id="reviewList"></div>
      <button class="editProfile" onclick="openReview()">Write Review</button>
    </div>
  </div>

  <div>
    <!-- Liked Items -->
    <div class="box">
      <h3>‚ù§Ô∏è Liked Items</h3><br>
      <div class="likedGrid" id="likedList"></div>
    </div>

    <!-- Payments Section -->
    <div class="box">
      <h3>üí∞ Payments</h3><br>
      <div id="paymentInfo">
        <p id="easypaisaDisplay" class="emptyState">No EasyPaisa account added yet.</p>
        <button class="editProfile" onclick="openPayment()">Add / Edit EasyPaisa</button>
      </div>
    </div>
  </div>
</div>
</section>

<!-- Profile Modal -->
<div class="modal" id="profileModal">
<div class="modalContent">
<span class="closeBtn" onclick="closeProfile()">&times;</span>
<h3>Edit Profile</h3>
<input id="nameInput" placeholder="Your Name">
<input id="phoneInput" placeholder="Phone Number">
<input id="emailInput" placeholder="Email">
<input id="countryInput" placeholder="Country">
<input id="cityInput" placeholder="City">
<input id="addressInput" placeholder="Home Address">
<input type="file" accept="image/*" id="avatarInput">
<button class="editProfile" onclick="saveProfile()">Save</button>
</div>
</div>

<!-- Payment Modal -->
<div class="modal" id="paymentModal">
<div class="modalContent">
<span class="closeBtn" onclick="closePayment()">&times;</span>
<h3>EasyPaisa Account</h3>
<input id="easypaisaInput" placeholder="EasyPaisa Account Number">
<input id="accountHolderInput" placeholder="Account Holder Name">
<button class="editProfile" onclick="savePayment()">Save</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCHMIBHlYGqyw4U7ZZplwi4LgQxga99nLM",
  authDomain: "aamilna.firebaseapp.com",
  projectId: "aamilna",
  storageBucket: "aamilna.firebasestorage.app",
  messagingSenderId: "127180284017",
  appId: "1:127180284017:web:b024e50670228b085f7bd0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const CLOUD_NAME = "dfmpbdhrv";
const UPLOAD_PRESET = "aamilna_unsigned";

let customer = null;
let currentAvatar = "";

const avatarImg = document.getElementById("avatar");

// üöÄ Load current customer
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "customer-login.html";
        return;
    }
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);
    if(!docSnap.exists()){
        alert("Profile not found");
        await signOut(auth);
        window.location.href = "customer-login.html";
        return;
    }
    customer = docSnap.data();
    customer.id = user.uid;
    currentAvatar = customer.avatar || "https://via.placeholder.com/150";
    loadProfileUI();
    loadOrders();
    loadReviews();
    loadLiked();
});

// üñº Avatar upload
document.getElementById("avatarInput").addEventListener("change", async function(e){
    const file = e.target.files[0];
    if(!file) return;
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);
    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {method:"POST", body:formData});
    const data = await res.json();
    currentAvatar = data.secure_url;
    avatarImg.src = currentAvatar;
});

function loadProfileUI(){
    avatarImg.src = currentAvatar;
    document.getElementById("cName").textContent = customer.name;
    document.getElementById("cEmail").textContent = customer.email;

    document.getElementById("nameInput").value = customer.name;
    document.getElementById("phoneInput").value = customer.phone || "";
    document.getElementById("emailInput").value = customer.email;
    document.getElementById("countryInput").value = customer.country || "";
    document.getElementById("cityInput").value = customer.city || "";
    document.getElementById("addressInput").value = customer.address || "";
    document.getElementById("easypaisaInput").value = customer.easypaisa || "";
    document.getElementById("accountHolderInput").value = customer.accountHolder || "";

    // Profile Summary
    const summary = document.getElementById("profileSummary");
    summary.innerHTML = `
        <div><span>Name:</span> ${customer.name || "-"}</div>
        <div><span>Phone:</span> ${customer.phone || "-"}</div>
        <div><span>Email:</span> ${customer.email || "-"}</div>
        <div><span>Country:</span> ${customer.country || "-"}</div>
        <div><span>City:</span> ${customer.city || "-"}</div>
        <div><span>Address:</span> ${customer.address || "-"}</div>
    `;

    const display = document.getElementById("easypaisaDisplay");
    if(customer.easypaisa && customer.easypaisa.trim() !== ""){
        display.textContent = `${customer.accountHolder} - ${customer.easypaisa}`;
        display.classList.remove("emptyState");
    } else {
        display.textContent = "No EasyPaisa account added yet.";
        display.classList.add("emptyState");
    }
}

// Save profile
async function saveProfile(){
    const name = document.getElementById("nameInput").value.trim();
    const phone = document.getElementById("phoneInput").value.trim();
    const email = document.getElementById("emailInput").value.trim();
    const country = document.getElementById("countryInput").value.trim();
    const city = document.getElementById("cityInput").value.trim();
    const address = document.getElementById("addressInput").value.trim();

    if(!name || !email){
        alert("Name and email required");
        return;
    }

    const docRef = doc(db, "users", customer.id);
    await updateDoc(docRef, {
        name, phone, email, country, city, address, avatar: currentAvatar
    });
    customer = {...customer, name, phone, email, country, city, address, avatar: currentAvatar};
    loadProfileUI();
    closeProfile();
}

async function savePayment(){
    const easypaisa = document.getElementById("easypaisaInput").value.trim();
    const accountHolder = document.getElementById("accountHolderInput").value.trim();
    if(!easypaisa || !accountHolder){ alert("Both required"); return; }
    const docRef = doc(db, "users", customer.id);
    await updateDoc(docRef, {easypaisa, accountHolder});
    customer.easypaisa = easypaisa;
    customer.accountHolder = accountHolder;
    loadProfileUI();
    closePayment();
}

// Modals
function openProfile(){ document.getElementById("profileModal").style.display="flex"; }
function closeProfile(){ document.getElementById("profileModal").style.display="none"; }
function openPayment(){ document.getElementById("paymentModal").style.display="flex"; }
function closePayment(){ document.getElementById("paymentModal").style.display="none"; }

// Dummy sections for orders/reviews/liked ‚Äî fetch from Firestore in real implementation
function loadOrders(){ /* fetch from Firestore orders collection if available */ }
function loadReviews(){ /* fetch from Firestore reviews collection if available */ }
function loadLiked(){ /* fetch from Firestore liked items if available */ }

// Logout
function logout(){
    signOut(auth).then(()=>{ window.location.href="customer-login.html"; });
}

</script>

</body>
</html>






















