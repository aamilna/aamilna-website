<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AaMilNa • Product</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;1,600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

<style>
body{font-family:'Poppins',sans-serif;background:#fff7f0;color:#4a3b47;padding:20px;max-width:900px;margin:0 auto;}
h1{font-family:'Playfair Display',serif;margin-bottom:10px;}
.gallery-container{position:relative;width:100%;height:400px;margin-bottom:15px;overflow:hidden;border-radius:18px;touch-action: pan-y;}
.gallery-container img{width:100%;height:100%;object-fit:cover;border-radius:18px;user-select:none;}
.gallery-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.7);border:none;font-size:24px;padding:6px 12px;cursor:pointer;border-radius:12px;user-select:none;}
.gallery-btn:hover{background:rgba(255,255,255,0.9);}
.gallery-btn.prev{left:10px;}
.gallery-btn.next{right:10px;}
.likes-container{display:flex;align-items:center;gap:8px;margin-bottom:10px;cursor:pointer;}
.heart{color:#ccc;font-size:24px;transition:.3s;}
.heart.liked{color:#e74c3c;transform:scale(1.3);}
button.add-cart{margin-top:10px;width:100%;padding:12px;border:none;border-radius:14px;background:#e7b7c8;cursor:pointer;font-weight:500;transition:.3s;}
button.add-cart:hover{background:#dca6b9;}
</style>
</head>
<body>

<a href="shop.html">← Back to Shop</a>
<h1 id="productName"></h1>
<div class="gallery-container">
  <img id="productImage" src="" alt="">
  <button class="gallery-btn prev">&#10094;</button>
  <button class="gallery-btn next">&#10095;</button>
</div>
<div class="likes-container">
  <span class="heart" id="productHeart">❤️</span>
  <span id="productLikes">0</span>
</div>
<p id="productPrice"></p>
<p id="productArtisan"></p>
<button class="add-cart" id="addToCartBtn">Add to Cart</button>

<script>
let product = JSON.parse(localStorage.getItem("currentProduct"));
if(!product) window.location.href="shop.html";

const images = product.images && product.images.length ? product.images : ["https://via.placeholder.com/400"];
let currentIndex=0;

const imgEl = document.getElementById("productImage");
const heart = document.getElementById("productHeart");
const likes = document.getElementById("productLikes");

document.getElementById("productName").textContent = product.name;
document.getElementById("productPrice").textContent = "PKR "+product.price;
document.getElementById("productArtisan").textContent = "By "+(product.artisanName||"Unknown Artisan");
likes.textContent = product.likes||0;
if(product.liked) heart.classList.add("liked");

// Gallery buttons
document.querySelector(".gallery-btn.prev").onclick = ()=>{ currentIndex=(currentIndex-1+images.length)%images.length; imgEl.src=images[currentIndex]; }
document.querySelector(".gallery-btn.next").onclick = ()=>{ currentIndex=(currentIndex+1)%images.length; imgEl.src=images[currentIndex]; }

// Mobile swipe
let startX=0;
imgEl.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
imgEl.addEventListener("touchend",e=>{
  const diff=e.changedTouches[0].clientX-startX;
  if(Math.abs(diff)>40){ if(diff>0) currentIndex=(currentIndex-1+images.length)%images.length; else currentIndex=(currentIndex+1)%images.length; imgEl.src=images[currentIndex]; }
});

// Heart
heart.onclick = () => {
  if(heart.classList.contains("liked")){ heart.classList.remove("liked"); product.likes=Math.max(0,product.likes-1); product.liked=false; }
  else { heart.classList.add("liked"); product.likes+=1; product.liked=true; }
  likes.textContent=product.likes;
  const allProducts = JSON.parse(localStorage.getItem("allProducts"))||[];
  allProducts.forEach(ap=>{ if(ap.name===product.name && ap.artisanName===product.artisanName){ ap.likes=product.likes; ap.liked=product.liked; } });
  localStorage.setItem("allProducts",JSON.stringify(allProducts));
  localStorage.setItem("currentProduct",JSON.stringify(product));
}

// Add to Cart
document.getElementById("addToCartBtn").onclick = () => {
  let cart = JSON.parse(localStorage.getItem("cart"))||[];
  const existing = cart.find(i=>i.name===product.name && i.artisanName===product.artisanName);
  if(existing) existing.qty+=1;
  else cart.push({name:product.name, price:product.price, image:images[0], artisanName:product.artisanName, qty:1});
  localStorage.setItem("cart",JSON.stringify(cart));
  alert("Added to cart");
}
</script>

</body>
</html>
