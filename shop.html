<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AaMilNa ‚Ä¢ Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;1,600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#fff7f0;color:#4a3b47;overflow-x:hidden;}

/* üå∏ Background Bubbles */
.bubble-bg{position:fixed;inset:0;z-index:-1;overflow:hidden;}
.bubble{position:absolute;width:260px;height:260px;border-radius:50%;
background:radial-gradient(circle at top left,rgba(255,255,255,0.9),rgba(255,220,230,0.45),rgba(200,150,170,0.25));
animation:float 30s infinite ease-in-out;}
.bubble::after{content:"üå∏";position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:70px;opacity:0.35;}
.bubble:nth-child(1){top:10%;left:6%;}
.bubble:nth-child(2){top:55%;left:72%;}
.bubble:nth-child(3){top:30%;left:42%;}
@keyframes float{50%{transform:translateY(-60px);}}

/* Header */
header{
  padding:26px 50px;
  background:rgba(255,255,255,0.85);
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{font-family:'Playfair Display',serif;font-style:italic;}
header a{text-decoration:none;font-weight:500;color:#4a3b47;}

/* Shop Grid */
.shop{max-width:1200px;margin:20px auto 80px;padding:0 30px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:30px;}
.card{
  background:white;
  padding:22px;
  border-radius:26px;
  box-shadow:0 18px 40px rgba(0,0,0,0.12);
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  cursor:pointer;
}

/* Gallery */
.gallery-container{
  position:relative;
  width:100%;
  height:190px;
  margin-bottom:10px;
  overflow:hidden;
  border-radius:18px;
  touch-action: pan-y;
}
.gallery-container img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:18px;
  user-select:none;
}
.gallery-btn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:rgba(255,255,255,0.7);
  border:none;
  font-size:18px;
  padding:4px 10px;
  cursor:pointer;
  border-radius:12px;
  user-select:none;
  z-index:2;
}
.gallery-btn:hover{background:rgba(255,255,255,0.9);}
.gallery-btn.prev{left:10px;}
.gallery-btn.next{right:10px;}

/* Heart & Likes */
.likes-container{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:10px;
}
.heart{
  color:#ccc;
  font-size:20px;
  transition: transform 0.3s, color 0.3s;
}
.heart.liked{
  color:#e74c3c;
  transform: scale(1.3);
  animation:pop 0.3s forwards;
}
@keyframes pop{
  0%{transform:scale(1);}
  50%{transform:scale(1.5);}
  100%{transform:scale(1.3);}
}
.likes-count{
  font-size:14px;
  font-weight:500;
  color:#4a3b47;
}

/* Product Info */
.card h4{margin-bottom:6px;}
.card p{font-size:14px;opacity:.85;margin-bottom:4px;}
.card button.add-cart{
  margin-top:10px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:14px;
  background:#e7b7c8;
  cursor:pointer;
  font-weight:500;
  transition:.3s;
}
.card button.add-cart:hover{background:#dca6b9;}
</style>
</head>

<body>

<div class="bubble-bg">
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
</div>

<header>
  <h1>Shop</h1>
  <a href="cart.html">üõí Cart</a>
</header>

<section class="shop">
  <div class="grid" id="shopGrid"></div>
</section>

<script>
// --- GET PRODUCTS ---
let allProducts = JSON.parse(localStorage.getItem("allProducts")) || [];

// Filter approved products, fallback to all if none match
let approvedProducts = allProducts.filter(p => p.statusAdmin === "Approved");
if(approvedProducts.length === 0) approvedProducts = allProducts;

// Initialize likes if missing
approvedProducts.forEach(p => { if(p.likes === undefined) p.likes = 0; });

// --- RENDER SHOP ---
function renderShop(){
  const grid = document.getElementById("shopGrid");
  grid.innerHTML = "";

  approvedProducts.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";

    let currentIndex = 0;
    const images = (p.images && p.images.length) ? p.images : ["https://via.placeholder.com/300"];

    card.innerHTML = `
      <div class="gallery-container">
        <img src="${images[0]}" alt="${p.name}">
        ${images.length>1 ? '<button class="gallery-btn prev">&#10094;</button><button class="gallery-btn next">&#10095;</button>' : ''}
      </div>
      <div class="likes-container">
        <span class="heart ${p.liked?'liked':''}">‚ù§Ô∏è</span>
        <span class="likes-count">${p.likes}</span>
      </div>
      <h4>${p.name}</h4>
      <p>PKR ${p.price}</p>
      <p>By ${p.artisanName || "Unknown Artisan"}</p>
      <button class="add-cart">Add to Cart</button>
    `;

    const galleryImg = card.querySelector(".gallery-container img");
    const prevBtn = card.querySelector(".gallery-btn.prev");
    const nextBtn = card.querySelector(".gallery-btn.next");
    const addCartBtn = card.querySelector(".add-cart");
    const heart = card.querySelector(".heart");
    const count = card.querySelector(".likes-count");

    // --- Gallery Navigation ---
    if(images.length > 1){
      prevBtn.onclick = e => { e.stopPropagation(); currentIndex=(currentIndex-1+images.length)%images.length; galleryImg.src=images[currentIndex]; }
      nextBtn.onclick = e => { e.stopPropagation(); currentIndex=(currentIndex+1)%images.length; galleryImg.src=images[currentIndex]; }
    }

    // --- Touch Swipe ---
    let startX = 0;
    galleryImg.addEventListener("touchstart", e => startX = e.touches[0].clientX);
    galleryImg.addEventListener("touchend", e => {
      const diff = e.changedTouches[0].clientX - startX;
      if(Math.abs(diff) > 40){
        currentIndex = diff>0 ? (currentIndex-1+images.length)%images.length : (currentIndex+1)%images.length;
        galleryImg.src = images[currentIndex];
      }
    });

    // --- Heart Like ---
    heart.onclick = e => {
      e.stopPropagation();
      if(heart.classList.contains("liked")){
        heart.classList.remove("liked");
        p.likes = Math.max(0, p.likes-1);
        p.liked = false;
      } else {
        heart.classList.add("liked");
        p.likes += 1;
        p.liked = true;
      }
      count.textContent = p.likes;

      // Save to localStorage
      const updatedProducts = JSON.parse(localStorage.getItem("allProducts")) || [];
      updatedProducts.forEach(ap => {
        if(ap.name === p.name && ap.artisanName === p.artisanName){
          ap.likes = p.likes;
          ap.liked = p.liked;
        }
      });
      localStorage.setItem("allProducts", JSON.stringify(updatedProducts));
    };

    // --- Add to Cart ---
    addCartBtn.onclick = e => {
      e.stopPropagation();
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(i => i.name===p.name && i.artisanName===p.artisanName);
      if(existing){ existing.qty += 1; }
      else{ cart.push({ name:p.name, price:p.price, image:images[0], artisanName:p.artisanName, qty:1 }); }
      localStorage.setItem("cart", JSON.stringify(cart));
      alert("Added to cart");
    };

    // --- Click to Product Page ---
    card.onclick = () => {
      localStorage.setItem("currentProduct", JSON.stringify(p));
      window.location.href = "product.html";
    };

    grid.appendChild(card);
  });
}

// --- INIT ---
renderShop();
</script>

</body>
</html>





















